# ============================================================================
# AtaHub Carona - ETL Configuration
# ============================================================================
# Copy this file to .env and adjust values as needed
# cp .env.example .env

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL connection string
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://postgres:password@localhost:5433/govcompras

# Connection pool settings
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10
DB_POOL_RECYCLE=3600

# ============================================================================
# API CONFIGURATION
# ============================================================================

# Brazilian Government Open Data API
API_BASE_URL=https://dadosabertos.compras.gov.br

# HTTP timeout in seconds
API_TIMEOUT=30

# Rate limiting (conservative for unknown API limits)
# 3.0 = 3 requests per second = 180/min = 10,800/hour
REQUESTS_PER_SECOND=3.0

# Retry configuration
MAX_RETRIES=3
RETRY_BACKOFF_FACTOR=2.0

# ============================================================================
# ETL DATE RANGES
# ============================================================================

# Initial load date range
# Format: YYYY-MM-DD
INITIAL_LOAD_START_DATE=2023-01-01
# INITIAL_LOAD_END_DATE=2025-12-31  # Optional, defaults to today

# Incremental updates lookback window (in days)
# 7 days = captures late API updates
INCREMENTAL_LOOKBACK_DAYS=7

# ============================================================================
# BATCH SIZES
# ============================================================================

# API pagination (max 500 allowed by API)
PAGE_SIZE=500

# Database batch sizes
BATCH_SIZE_ARPS=100
BATCH_SIZE_ITEMS=500

# ============================================================================
# CONCURRENCY CONTROL
# ============================================================================

# Maximum concurrent API requests for items
MAX_CONCURRENT_ITEM_REQUESTS=5

# Maximum concurrent database operations
MAX_CONCURRENT_DB_OPERATIONS=3

# ============================================================================
# SCHEDULER CONFIGURATION
# ============================================================================

# Enable automatic scheduling
ETL_SCHEDULE_ENABLED=true

# Daily execution time (24-hour format)
ETL_SCHEDULE_HOUR=2
ETL_SCHEDULE_MINUTE=0

# Timezone (Brazilian timezone)
ETL_SCHEDULE_TIMEZONE=America/Sao_Paulo

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Log file path (relative to etl directory)
LOG_FILE_PATH=logs/etl.log

# Log format: 'json' or 'console'
LOG_FORMAT=json

# Log rotation
LOG_MAX_BYTES=10485760  # 10 MB
LOG_BACKUP_COUNT=5

# ============================================================================
# ETL BEHAVIOR
# ============================================================================

# Save checkpoint every N pages
CHECKPOINT_FREQUENCY=10

# Use soft deletes instead of hard deletes
ENABLE_SOFT_DELETE=true

# Resume failed executions from checkpoint
RESUME_FAILED_EXECUTIONS=true

# Validate data before insertion
VALIDATE_DATA=true

# ============================================================================
# MONITORING & ALERTS
# ============================================================================

# Enable alerts on failure
ALERT_ON_FAILURE=false

# Email for alerts (optional)
# ALERT_EMAIL=admin@example.com

# Webhook URL for alerts - Slack, Discord, etc (optional)
# ALERT_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# Maximum error rate before failing (percentage)
MAX_ERROR_RATE_PERCENT=5.0

# ============================================================================
# DEVELOPMENT & TESTING
# ============================================================================

# Debug mode (more verbose logging)
DEBUG_MODE=false

# Dry run (fetch but don't commit)
DRY_RUN=false

# Test mode (smaller limits)
TEST_MODE=false
TEST_MAX_PAGES=2

# ============================================================================
# DOCKER-SPECIFIC OVERRIDES
# ============================================================================
# When running in Docker, uncomment and adjust:

# DATABASE_URL=postgresql://postgres:password@db:5432/govcompras
